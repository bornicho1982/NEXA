# Handoff: R4 Manifest & Data Layer

**Fecha**: 2026-02-16
**Rol**: R4 Manifest
**Estado**: ✅ Completado

## Resumen Ejecutivo

Sistema de Manifest de Destiny 2 implementado. El servicio descarga definiciones estáticas de Bungie (Items, Stats, Clases) y las almacena localmente en JSON. Se ha optimizado la carga en memoria usando lectura paralela y patrón de caché global para Hot Reloading.

## Entregables Técnicos

### 1. Servicio Manifest (`src/lib/manifest/service.ts`)

- **Carga en Memoria**: Al inicio del servidor, lee todos los JSONs en paralelo.
- **Persistencia**: Archivos guardados en `/data/manifest/*.json`.
- **Global Cache**: Evita recargas innecesarias en desarrollo.

### 2. API Endpoints

- **GET `/api/manifest/status`**: Retorna versión actual y estado de carga.
- **POST `/api/manifest/update`**: Fuerza la comprobación y descarga de nueva versión desde Bungie.

### 3. Tipos (`src/types/destiny.ts`)

- Definiciones completas para Items, Stats, DamageType, etc.

## Decisiones Técnicas

- **JSON vs SQLite**: Para MVP se usan archivos JSON planos. Es más rápido de implementar y leer en Node.js para volúmenes medianos (<100MB).
- **Parallel Loading**: `Promise.all` reduce el tiempo de arranque del servidor.
- **Cold Boot**: En serverless (Vercel), cada cold boot leerá los archivos. Si el rendimiento es crítico, mover a base de datos externa en V1.

## Siguientes Pasos (Handoff a R5)

- **R5 Inventory** debe usar `getDefinition(hash)` para "hidratar" los items crudos de la API de Bungie (que solo traen `itemHash`).
