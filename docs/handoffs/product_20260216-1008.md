# Handoff: R2 Product & Specs

**Fecha**: 2026-02-16
**Rol**: R2 Product & Functional Specs
**Estado**: ✅ Completado

## Resumen Ejecutivo

Se han definido los requisitos funcionales del MVP de NEXA. El alcance se ha cerrado para priorizar **Autenticación Robusta**, **Inventario Funcional** y **Build Optimizer**.
Features secundarias como *Limpieza de Bóveda* y *Notificaciones* se han postergado a V1.

## Entregables Generados

### 1. Definición de MVP (Scope)

- **Documento**: [`docs/features.md`](../features.md)
- **Highlights**:
  - Prioridad Crítica: Token Refresh Automático (middleware).
  - Prioridad Alta: Tests Unitarios Core.
  - Scope Out (V1): Comparador de Items, Notificaciones.

### 2. Flujos de Usuario (Diagramas)

- **Documento**: [`docs/user-flows/mvp-flows.md`](../user-flows/mvp-flows.md)
- **Flujos Críticos**:
  - Login OAuth2 con persistencia.
  - Sincronización de Inventario (perfil + manifest).
  - Optimización de Stats (combinatoria).
  - Chat con IA (streaming context).

### 3. Contratos de API (Specs)

- **Documento**: [`docs/api-contracts/mvp-api.md`](../api-contracts/mvp-api.md)
- **Endpoints Clave Documentados**:
  - `GET /api/inventory`: Estructura unificada de respuesta.
  - `POST /api/builds/optimize`: Input parameters para engine.
  - `GET /api/auth/*`: Ciclo de vida OAuth.

## Decisiones de Producto

- **Autenticación**: Se requiere manejo transparente de expiración de token. El usuario no debe loguearse de nuevo cada hora. Esto es tarea crítica de **R3 Backend**.
- **Base de Datos**: Se usará SQLite (Prisma) para persistir sesiones y loadouts. El inventario NO se persiste (se cachea en memoria/Bungie API live).

## Riesgos Identificados

- **Token Refresh**: La lógica de refresh token de Bungie es compleja y puede fallar. Se requiere testing exhaustivo.
- **Rate Limits**: La API de Bungie tiene límites estrictos. El cliente debe implementar backoff (responsabilidad de R3/R4).

## Siguientes Pasos (Handoff a R3)

- **R3 Backend** debe implementar el middleware de autenticación y asegurar que los endpoints listados en `mvp-api.md` funcionen según contrato.
- Validar esquema de base de datos en `schema.prisma`.
