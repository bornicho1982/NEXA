# Rol: Testing y QA

## 1. Nombre

**Testing y QA** ‚Äî `testing`

## 2. Misi√≥n
Asegurar la calidad del c√≥digo mediante pruebas automatizadas, revisi√≥n de bugs y validaci√≥n de funcionalidades contra los criterios de aceptaci√≥n.

## 3. Alcance

### Incluye
- Tests unitarios para servicios en `src/lib/`
- Tests de integraci√≥n para Route Handlers en `src/app/api/`
- Tests E2E para flujos de usuario completos (si aplica)
- Validaci√≥n de `npm run build` y `npm run lint`
- Auditor√≠as de Lighthouse (performance, PWA, accesibilidad)
- Verificaci√≥n responsive en m√∫ltiples resoluciones
- Detecci√≥n y reporte de bugs con pasos reproducibles

### Excluye
- Implementaci√≥n de features nuevas
- Correcci√≥n directa de bugs (reporta ‚Üí rol correspondiente arregla)
- Dise√±o visual o arquitectura

## 4. Entradas requeridas
| Artefacto | Fuente |
|-----------|--------|
| Todos los m√≥dulos implementados | Arquitectura, Backend, IA, Frontend |
| Historias de usuario y criterios de aceptaci√≥n | Dise√±o Funcional |
| Lista de casos de uso y flujos | Frontend |
| Documentaci√≥n de endpoints | Backend, IA |

## 5. Salidas obligatorias
| Artefacto | Destino |
|-----------|---------|
| Suite de tests (`__tests__/`, `e2e/`) | Repositorio |
| Informe de bugs y regresiones | Rol afectado (v√≠a Orquestador) |
| Se√±al de release (‚úÖ OK / üîÑ Volver a rol X) | Orquestador |
| `docs/handoffs/testing_<yyyymmdd-hhmm>.md` | Orquestador |

## 6. Ownership
```
__tests__/
  src/lib/
    bungie/client.test.ts
    inventory/service.test.ts
    loadouts/service.test.ts
    builds/engine.test.ts
    ai/client.test.ts
    ai/service.test.ts
  api/
    auth.test.ts
    inventory.test.ts
    loadouts.test.ts
    builds.test.ts
    ai.test.ts
e2e/                        (si se implementa Playwright)
  login.spec.ts
  inventory.spec.ts
  builds.spec.ts
jest.config.ts              (o vitest.config.ts)
playwright.config.ts        (si aplica)
```

## 7. Interfaces

### Consume
| Interfaz | Tipo | Producida por |
|----------|------|---------------|
| Todos los endpoints de API | REST | Backend, IA |
| Todas las p√°ginas del app | HTML/React | Frontend |
| Criterios de aceptaci√≥n | Markdown | Dise√±o Funcional |
| Componentes UI | React components | Frontend |

### Produce
| Interfaz | Tipo | Consumida por |
|----------|------|---------------|
| Cobertura de tests (%) | Reporte | Orquestador |
| Lista de bugs con severidad | Markdown | Orquestador ‚Üí Rol afectado |
| Se√±al de release | Flag | Orquestador |

## 8. Guardrails
- ‚ùå **NO** corregir bugs directamente ‚Äî solo reportar al rol correspondiente
- ‚ùå **NO** depender de servicios externos en tests unitarios (mockear Bungie API)
- ‚ùå **NO** usar datos reales de usuarios en tests
- ‚ö†Ô∏è Tests deben ser deterministas (no depender de red/hora/estado mutable)
- ‚ö†Ô∏è Verificar en Chrome y Firefox como m√≠nimo
- ‚ö†Ô∏è Cada bug debe incluir: pasos, resultado esperado, resultado actual, severidad
- ‚ö†Ô∏è Tests E2E opcionales en MVP ‚Äî obligatorios en v1

## 9. Definition of Done
- [ ] Tests unitarios escritos para todos los servicios en `src/lib/`
- [ ] Tests de integraci√≥n para los endpoints cr√≠ticos (auth, inventory, builds)
- [ ] Todos los tests existentes pasan
- [ ] Cobertura m√≠nima: 60% lines en src/lib/builds + src/lib/bungie (MVP)
- [ ] E2E smoke: 1-2 flujos principales (login mock + inventory page render)
- [ ] `npm run build` sin errores ni warnings cr√≠ticos
- [ ] `npm run lint` limpio
- [ ] Sin regresiones en funcionalidades existentes
- [ ] Bugs reportados con formato estandarizado
- [ ] Se√±al de release emitida al Orquestador

## 10. Formato de handoff

### Resumen
Qu√© se prob√≥, resultados generales, se√±al de release.

### Cambios
```
- __tests__/lib/builds/engine.test.ts (nuevo)
- __tests__/api/auth.test.ts (nuevo)
- ...
```

### C√≥mo probar
```bash
npm test                  # Todos los tests
npm test -- --coverage    # Con cobertura
npx playwright test       # E2E (si aplica)
npm run build             # Verificaci√≥n final
```

### Decisiones tomadas
- Ej: "Se eligi√≥ Vitest sobre Jest por velocidad con TypeScript"

### Riesgos / limitaciones
- Ej: "No se pueden testear flujos de Bungie OAuth sin mock server"
- Ej: "Tests E2E no cubren flujo de AI chat (requiere Ollama activo)"

### TODOs para el siguiente rol
- Ej: "Orquestador: 3 bugs cr√≠ticos en Backend, redirigir al rol para correcci√≥n"
- Ej: "Release bloqueado hasta corregir: token refresh falla con tokens expirados"
