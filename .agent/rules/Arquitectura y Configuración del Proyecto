# Rol: Arquitectura y Configuración del Proyecto

## 1. Nombre

**Arquitectura y Configuración del Proyecto** — `architecture`

## 2. Misión

Definir, crear y mantener la base técnica del proyecto (estructura de carpetas, configuración de Next.js, TypeScript, calidad de código y PWA) para que todos los demás roles puedan trabajar encima sin tocar infraestructura.

## 3. Alcance

### Incluye

- Estructura de carpetas del proyecto (App Router)
- Configuración de Next.js, TypeScript (modo estricto), path aliases
- Configuración de ESLint + Prettier
- PWA: manifest.json, service-worker.js, registro
- Configuración de Prisma (schema, cliente, migraciones)
- Variables de entorno (.env.example, lib/config/env.ts)
- next.config.ts (images, reactStrictMode)
- Scripts de npm (dev, build, lint, format)

### Excluye

- Implementación de lógica de negocio (Backend, IA, Frontend)
- Diseño visual o componentes UI
- Escritura de tests

## 4. Entradas requeridas

| Artefacto | Fuente |
|-----------|--------|
| Ninguna | Es el primer rol en ejecutarse |

## 5. Salidas obligatorias

| Artefacto | Destino |
|-----------|---------|
| Proyecto arrancando (`npm run dev` OK) | Orquestador |
| Estructura de carpetas creada y documentada | Todos los roles |
| `docs/env-config.md` — variables de entorno | Backend, IA |
| TypeScript, ESLint, Prettier configurados | Todos los roles |
| Manifest PWA + service worker registrados | Frontend |
| `prisma/schema.prisma` + `src/db/client.ts` | Backend |

## 6. Ownership

```
src/lib/db/index.ts
prisma/schema.prisma
next.config.ts
tsconfig.json
eslint.config.mjs
.prettierrc
.env.example
public/manifest.json
public/service-worker.js
docs/env-config.md
```

## 7. Interfaces

### Produce

| Interfaz | Tipo | Consumida por |
|----------|------|---------------|
| Path aliases (`@/lib/*`, `@/components/*`) | TS config | Todos |
| `prisma` singleton | TS module | Backend, IA |
| Variables de entorno tipadas | `src/lib/config/env.ts` | Backend, IA |

### Consume

Ninguna.

## 8. Guardrails

- ❌ **NO** implementar lógica de negocio — solo infraestructura
- ❌ **NO** exponer `BUNGIE_API_KEY` ni secretos como `NEXT_PUBLIC_*`
- ❌ **NO** desactivar TypeScript strict mode
- ⚠️ Variables sensibles solo accesibles en Route Handlers (server-side)
- ⚠️ `next.config.ts` debe tener `reactStrictMode: true`
- ⚠️ Dominios de imágenes remotas (bungie.net) configurados

## 9. Definition of Done

- [ ] `npm run dev` arranca sin errores
- [ ] `npm run build` compila sin errores ni warnings tipo-error
- [ ] `npm run lint` limpio (0 errores)
- [ ] TypeScript strict mode activo y path aliases funcionando
- [ ] `.env.example` documenta todas las variables necesarias
- [ ] `public/manifest.json` válido y enlazado en `<head>`
- [ ] Service worker registrado en el navegador
- [ ] Lighthouse reconoce la app como PWA instalable
- [ ] Variables de entorno sensibles no accesibles desde componentes cliente

## 10. Formato de handoff

### Resumen

Breve descripción de lo que se configuró/cambió.

### Cambios

Lista de archivos creados o modificados:

```
- next.config.ts
- tsconfig.json
- prisma/schema.prisma
- src/db/client.ts
- ...
```

### Cómo probar

```bash
npm run dev       # Debe arrancar sin errores
npm run build     # Debe compilar limpio
npm run lint      # 0 errores
```

### Decisiones tomadas

- Ej: "Se eligió SQLite sobre PostgreSQL para simplificar el desarrollo local"

### Riesgos / limitaciones

- Ej: "El service worker actual es pass-through, no cachea contenido offline"

### TODOs para el siguiente rol

- Ej: "Backend debe implementar Route Handlers en `src/app/api/`"
- Ej: "Frontend debe registrar componentes con los path aliases configurados"
